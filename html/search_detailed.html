<!DOCTYPE html>
<html>
<head>
	<title>Detailed Search</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">	<link rel="stylesheet" type="text/css" href="../css/reset.css">
	<link rel="stylesheet" type="text/css" href="../css/search_detailed.css">
	<link rel="stylesheet" type="text/css" href="../css/navbar.css">
	<link rel="stylesheet" type="text/css" href="../css/single-movie.css">
	<link rel="stylesheet" type="text/css" href="../css/index.css">
	<link rel="stylesheet" href="../fonts/css/alk-rex-bold.min.css">
	<link rel="stylesheet" href="../fonts/css/bpg-arial.min.css">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
</head>
<body>
	<nav class = 'navbar'>
		<!-- LOGO -->
		<!-- <div class = 'logo'> -->
			<a href="index.html" class="logo">
				<svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="slack" class="svg-inline--fa fa-slack fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg>
			</a>
		<!-- </div> -->
		<!-- LOGO -->
		<ul class = 'navbar-ul'>
			<!-- MAIN TITLE -->
			<li class ='nav-title'>
				<a href="index.html">YOUR-MOVIES</a>
			</li>
			<!-- MAIN TITLE -->
				<!-- SEARCH -->
			<li class = 'nav-search'>
				<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fed700" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
				<input id="searchInput" type="" name="" placeholder="სწრაფი ძიება">
				<!-- HIDDEN SEARCH RESULTS -->
				<ul id="searchResults" class = 'search-results-ul'>

				</ul>
				<!-- HIDDEN SEARCH RESULTS -->
			</li>
				<!-- SEARCH -->

				<!-- NAV ITEMS -->
			<li class = 'nav-item'>
				<a href="search_detailed.html" class = 'nav-link'>ფილმები</a>
			</li>
			<li class = 'nav-item'>
				<a href="wishlist.html" class = 'nav-link'>სურვილები</a>
			</li>
			<li class = 'nav-item'>
				<a href="register.html" class = 'nav-link'>ავტორიზაცია</a>
			</li>
				<!-- NAV ITEMS -->

				<!-- RESPONSIVE NAV ITEMS -->

			<div class = 'navbar-responsive'>
				<li>
					<a href="search_detailed.html">
						<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="film" class="svg-inline--fa fa-film fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fed700" d="M488 64h-8v20c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12V64H96v20c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12V64h-8C10.7 64 0 74.7 0 88v336c0 13.3 10.7 24 24 24h8v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h320v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h8c13.3 0 24-10.7 24-24V88c0-13.3-10.7-24-24-24zM96 372c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm272 208c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm0-168c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm112 152c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40z"></path></svg>				
					</a>
				</li>
				<li>
					<a href="wishlist.html">
						<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve"><metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata><g><g><g><path fill="#fed700" d="M921.9,239.5L692.3,10H78.1v980h843.7V239.5L921.9,239.5z M712.9,129.7l89.3,89.3h-89.3V129.7z M851.7,919.9H148.3V80.1h494.5v209h209V919.9z"/><rect fill="#fed700" x="452.7" y="392" width="340.3" height="70.1"/><polygon fill="#fed700" points="269.3,567.3 241.8,539.7 192.2,589.3 269.3,666.4 396.8,539 347.2,489.4 "/><polygon fill="#fed700" points="269.3,741.9 241.8,714.4 192.2,764 269.3,841.1 396.8,713.7 347.2,664.1 "/><polygon fill="#fed700" points="269.3,392.6 241.8,365 192.2,414.6 269.3,491.8 396.8,364.3 347.2,314.7 "/><rect fill="#fed700" x="452.7" y="566.8" width="340.3" height="70.1"/><rect fill="#fed700" x="452.7" y="741.6" width="340.3" height="70.1"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></g></svg>
					</a>
				</li>
				<li>
					<a href="register.html">
						<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-circle" class="svg-inline--fa fa-user-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="#fed700" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"></path></svg>				
					</a>
				</li>
			</div>
				<!-- RESPONSIVE NAV ITEMS -->

		</ul>
	</nav>
	
	<!-- DETAILED SEARCH -->
	<div id="body" class = 'detailed-search-body-wrapper'>
		<div class = 'form-wrapper'>
			<div class = 'search-form'>
				<span>საძიებო სიტყვა</span>
				<div class = 'search-term'>
					<input id="filterInput" type="" name="">
					<button onclick="filter()" style="cursor: pointer;">ძიება</button>
				</div>
				<div class = 'filter-wrapper'>
					<div class = 'filter-single'>
						<label for ='quality'>ხარისხი</label>
						<select id="quality" name = 'quality' onchange="searchFilter()">
							<option value=0>ყველა</option>
							<option value=1>720p</option>
							<option value=2>1080p</option>
							<option value=3>2160p</option>
							<option value=4>3D</option>
						</select>
					</div>
					<div class = 'filter-single'>
						<label for = 'genre'>ჟანრი</label>
						<select id="genre" name = 'genre' onchange="searchFilter()">
							<option value=0>ყველა</option>
							<option value=1>კომედია</option>
							<option value=2>სამეცნიერო ფანტასტიკა</option>
							<option value=3>საშინელებათა</option>
							<option value=4>რომანტიკა</option>
							<option value=5>ექშენი</option>
							<option value=6>თრილერი</option>
							<option value=7>მისტიკა</option>
							<option value=8>კრიმინალი</option>
							<option value=9>ანიმაცია</option>
							<option value=10>სათავგადასავლო</option>
							<option value=11>ფანტასტიკა</option>
							<option value=12>დრამა</option>
							<option value=13>ისტორია</option>
							<option value=14>ბიოგრაფია</option>
							<option value=15>დოკუმენტალური</option>
							<option value=16>საოჯახო</option>
							<option value=17>ფილმ-ნოირი</option>
							<option value=18>გეიმ-შოუ</option>
							<option value=19>მუსიკა</option>
							<option value=20>მუსიკალური</option>
							<option value=21>სიახლეები</option>
							<option value=22>რეალითი-ტივი</option>
							<option value=23>სპორტი</option>
							<option value=24>ომი</option>
							<option value=25>თალქ-შოუ</option>
							<option value=26>ვესტერნი</option>
						</select>
					</div>
					<div class = 'filter-single'>
						<label for = 'rating'>რეიტინგი</label>
						<select id="rating" name = 'rating' onchange="searchFilter()">
							<option value=0>ყველა</option>
							<option value=1>1+</option>
							<option value=2>2+</option>
							<option value=3>3+</option>
							<option value=4>4+</option>
							<option value=5>5+</option>
							<option value=6>6+</option>
							<option value=7>7+</option>
							<option value=8>8+</option>
							<option value=9>9+</option>
						</select>
					</div>
					<div class = 'filter-single'>
						<label for = 'orderby'>დალაგება</label>
						<select id="orderBy" name = 'orderby' onchange="searchFilter()">
							<option value=0>კლების მიხედვით</option>
							<option value=1>ზრდის მიხედვით</option>
						</select>
					</div>
					<div class = 'filter-single'>
						<label for = 'sortby'>თანმიმდევრობა</label>
						<select id="sortBy" name = 'sortby' onchange="searchFilter()">
							<option value=0>თარიღი</option>
							<option value=1>სახელი</option>
							<option value=2>წელი</option>
							<option value=3>შეფასება</option>
							<option value=4>გადმოწერები</option>
							<option value=5>მოწონებები</option>
						</select>
					</div>

				</div>

			</div>
		</div>
	</div>
	<!-- DETAILED SEARCH -->
	<!-- PAGING -->
	<div class = 'pagination'>
		<ul id="pageWrapperTop" class = 'page-list'>

		</ul>
	</div>
	<!-- PAGING -->
	<!-- MOVIE LIST -->
	<div class = 'detailed-search-movie-body'>
		<div class = 'detailed-search-movies'>
			<div id="results" class = 'movie-single-wrapper'>
				<!-- SINGLE MOVIE -->
				
				<!-- SINGLE MOVIE -->
			</div>			
		</div>
	</div>
	<!-- MOVIE LIST -->

<script src="../javascript/main.js"></script>
<script>

qualitiesArray = ['all', '720p', '1080p', '2160p', '3D'];
var genresArray = ['all', 'comedy', 'sci-fi', 'horror', 'romance', 'action', 'thriller', 'mystery', 'crime',
	'animation', 'adventure', 'fantasy', 'drama', 'history', 'biography', 'documentary', 'family', 'film-noir',
	'game-show', 'music', 'musical', 'news', 'reality-tv', 'sport', 'war', 'talk-show', 'western'];
var sortByArray = ['date_added', 'title', 'year', 'rating', 'download_count', 'like_count'];
var orderByArray = ['desc', 'asc']

let quality = document.getElementById('quality');
let genre = document.getElementById('genre');
let rating = document.getElementById('rating');
let orderBy = document.getElementById('orderBy');
let sortBy = document.getElementById('sortBy');

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);

results = document.getElementById('results');
page = 1;
queryTerm = ''
limit = 20;

if(urlParams.get('limit')) {limit = urlParams.get('limit')}
if(urlParams.get('page')) {page = urlParams.get('page')}
if(urlParams.get('quality')) {quality.value = urlParams.get('quality');}
if(urlParams.get('rating')) {rating.value = urlParams.get('rating');}
if(urlParams.get('queryterm')) {queryTerm = urlParams.get('queryterm');}
if(urlParams.get('genre')) {genre.value = urlParams.get('genre');}
if(urlParams.get('sortby')) {sortBy.value = urlParams.get('sortby');}
if(urlParams.get('orderby')) {orderBy.value = urlParams.get('orderby');}


document.getElementById('filterInput').value = queryTerm;


function getMovies(url){
		function render(){
			let response = this.responseText;
			data = JSON.parse(response).data
			let movies = data.movies;

			paginate(data.movie_count, data.limit, data.page_number);

			let fragment = document.createDocumentFragment();
			
			if(typeof movies == 'undefined'){ return 0 }
			movies.forEach(el => {
				let main_div = document.createElement('div');
				let img_wrapper = document.createElement('a');
				let properties = document.createElement('div');
				let img = document.createElement('img');
				let star = document.createElement('span');
				let rating = document.createElement('span');
				let category = document.createElement('span');
				let btn = document.createElement('button');
				let title = document.createElement('span');
				let year = document.createElement('p');

				main_div.className = 'movie-single';
				img_wrapper.className = 'movie-single-img-wrapper';
				properties.className = 'movie-single-properties';
				star.className = 'movie-single-star';
				rating.className = 'movie-single-rating';
				category.className = 'movie-single-category';
				btn.className = 'movie-single-button';
				img_wrapper.href = 'movie-detailed.html?movie_id=' + el.id;

				main_div.appendChild(img_wrapper);
				main_div.appendChild(properties);
				img_wrapper.appendChild(img);
				img_wrapper.appendChild(star);
				img_wrapper.appendChild(rating);
				img_wrapper.appendChild(category);
				img_wrapper.appendChild(btn);
				properties.appendChild(title);
				properties.appendChild(year);

				img.alt = el.title_long

				img.src = el.medium_cover_image;
				img.onerror = function() { if (img.src != 'error.jpg') img.src = '../images/loading.gif' }
				rating.innerText = el.rating + '/10';
				category.innerText = el.category;
				star.innerText = '★';
				btn.innerText = 'სრულად ნახვა';
				if(typeof el.genres !== 'undefined'){category.innerText = el.genres.join(" / ");}
				title.innerText = el.title;
				year.innerText = el.year;

				fragment.appendChild(main_div);
			});
			results.innerHTML = '';
			results.appendChild(fragment);

		}
		let req = new XMLHttpRequest();
		req.addEventListener('load', render);
		req.open('GET', url);
		req.send();     
	}

	getMovies(`https://yts.mx/api/v2/list_movies.json?limit=${limit}&page=${page}&quality=${qualitiesArray[quality.value]}&minimum_rating=${rating.value}&query_term=${queryTerm}&genre=${genresArray[genre.value]}&sort_by=${sortByArray[sortBy.value]}&order_by=${orderByArray[orderBy.value]}`);
	
	function filter() {
		quality = document.getElementById('quality');
		genre = document.getElementById('genre');
		rating = document.getElementById('rating');
		orderBy = document.getElementById('orderBy');
		sortBy = document.getElementById('sortBy');
		queryTerm = document.getElementById('filterInput').value;
		getMovies(`https://yts.mx/api/v2/list_movies.json?limit=${limit}&page=${page}&quality=${qualitiesArray[quality.value]}&minimum_rating=${rating.value}&query_term=${queryTerm}&genre=${genresArray[genre.value]}&sort_by=${sortByArray[sortBy.value]}&order_by=${orderByArray[orderBy.value]}`);
	}

	function searchFilter() {
		let newURL = location.href.split("?")[0];
		let params = [];
		if(quality.value != 0){params.push('quality=' + quality.value)}
		if(genre.value != 0){params.push('genre=' + genre.value)}
		if(rating.value != 0){params.push('rating=' + rating.value)}
		if(orderBy.value != 0){params.push('orderby=' + orderBy.value)}
		if(sortBy.value != 0){params.push('sortby=' + sortBy.value)}
		if(page != 1){params.push('page=' + page)}
		if(filterInput.value != ''){params.push('queryterm=' + filterInput.value)}
		window.history.replaceState('object', document.title, newURL+'?'+params.join('&'));
	}

	filterInput.onkeypress = function(event) {
		if (event.keyCode === 13) {
			filter();
		}
	};
	filterInput.onkeydown = function(event) {
		setTimeout(function() {
			searchFilter();
		}, 0);
	};


	function paginate(movie_count, limit, page_number) {
		searchFilter();
		page_count = Math.floor(movie_count/limit)
		if(movie_count == 0){
			document.getElementById('pageWrapperTop').innerHTML = '';
			let notFound = document.createElement('p');
			notFound.innerText = '0 შედეგი :('
			notFound.style.color = 'white';
			notFound.style.fontSize = '20px';
			document.getElementById('pageWrapperTop').appendChild(notFound); 
			results.innerHTML = '';
			return 0;
		}
		let visiblePages;
		if(page_count <= 10){visiblePages = page_count;
		} else { visiblePages = 10 }

		let pagesFrag = document.createDocumentFragment();
		for (let i = 1; i < visiblePages+1; i++) {
			let li = document.createElement('li');
			let span = document.createElement('span');
			li.appendChild(span);
			li.className = 'single-page';
			span.innerText = i
			li.onclick = function() {
				page = i;
				filter();
			}
			if(page == i) { li.style.backgroundColor = 'red'; page = 1 }

			pagesFrag.appendChild(li);
		}
		document.getElementById('pageWrapperTop').innerHTML = '';
		document.getElementById('pageWrapperTop').appendChild(pagesFrag);
	}


</script>
</body>
</html>